<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoChallenge - Environmental Activity Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .task-card {
            transition: all 0.3s ease;
        }
        
        .task-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .points-animation {
            animation: pointsGlow 2s ease-in-out;
        }
        
        @keyframes pointsGlow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); color: #10b981; }
        }
        
        .upload-area {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: #10b981;
            background-color: #f0fdf4;
        }
        
        .upload-area.dragover {
            border-color: #059669;
            background-color: #ecfdf5;
        }
        
        .progress-bar {
            transition: width 0.5s ease;
        }
        
        .badge {
            animation: badgeAppear 0.5s ease-out;
        }
        
        @keyframes badgeAppear {
            0% { transform: scale(0) rotate(180deg); opacity: 0; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg">
        <div class="max-w-6xl mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="text-4xl">🌱</div>
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800">EcoChallenge</h1>
                        <p class="text-gray-600">Make a difference, earn points!</p>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-3xl font-bold text-green-600" id="totalPoints">0</div>
                    <div class="text-sm text-gray-600">Total Points</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Section -->
    <div class="max-w-6xl mx-auto px-4 py-6">
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Your Progress</h2>
            <div class="flex items-center space-x-4">
                <div class="flex-1">
                    <div class="flex justify-between text-sm text-gray-600 mb-2">
                        <span>Level Progress</span>
                        <span id="levelText">Level 1</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3">
                        <div class="progress-bar bg-gradient-to-r from-green-400 to-green-600 h-3 rounded-full" id="progressBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="text-2xl" id="levelBadge">🌱</div>
            </div>
        </div>
    </div>

    <!-- Tasks Section -->
    <div class="max-w-6xl mx-auto px-4 pb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Available Tasks</h2>
        
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="tasksContainer">
            <!-- Tasks will be dynamically generated -->
        </div>
    </div>

    <!-- Completed Tasks -->
    <div class="max-w-6xl mx-auto px-4 pb-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Completed Tasks</h2>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="completedTasksContainer">
            <div class="text-center text-gray-500 py-8">
                <div class="text-4xl mb-2">🎯</div>
                <p>Complete tasks to see them here!</p>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full mx-4">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-semibold text-gray-800" id="modalTitle">Upload Proof</h3>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="upload-area rounded-lg p-8 text-center mb-4" id="uploadArea">
                    <div class="text-4xl mb-2">📸</div>
                    <p class="text-gray-600 mb-2">Click to upload or drag and drop</p>
                    <p class="text-sm text-gray-400">PNG, JPG up to 10MB</p>
                    <input type="file" id="fileInput" accept="image/*" class="hidden">
                </div>
                
                <div id="imagePreview" class="hidden mb-4">
                    <img id="previewImg" class="w-full h-48 object-cover rounded-lg">
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="closeModal()" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button onclick="submitTask()" id="submitBtn" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50" disabled>
                        Submit Task
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Task data
        const tasks = [
            {
                id: 1,
                title: "Plant a Tree",
                description: "Plant a tree in your garden or community area",
                points: 10,
                icon: "🌳",
                category: "Planting"
            },
            {
                id: 2,
                title: "Collect Plastic Bottles",
                description: "Collect plastic bottles and submit to class teacher",
                points: 1,
                icon: "♻️",
                category: "Recycling",
                perItem: true
            },
            {
                id: 3,
                title: "Create from Waste",
                description: "Make something useful from waste materials",
                points: 15,
                icon: "🎨",
                category: "Upcycling"
            },
            {
                id: 4,
                title: "Clean Public Space",
                description: "Clean a park, beach, or public area",
                points: 8,
                icon: "🧹",
                category: "Cleaning"
            },
            {
                id: 5,
                title: "Start Composting",
                description: "Begin composting organic waste at home",
                points: 12,
                icon: "🍂",
                category: "Composting"
            },
            {
                id: 6,
                title: "Use Public Transport",
                description: "Use public transport instead of private vehicle for a day",
                points: 5,
                icon: "🚌",
                category: "Transport"
            }
        ];

        let currentTask = null;
        let totalPoints = 0;
        let completedTasks = [];
        let currentLevel = 1;

        // Initialize the app
        function init() {
            renderTasks();
            updateProgress();
            setupEventListeners();
        }

        // Render tasks
        function renderTasks() {
            const container = document.getElementById('tasksContainer');
            container.innerHTML = '';

            tasks.forEach(task => {
                if (!completedTasks.find(ct => ct.id === task.id)) {
                    const taskCard = createTaskCard(task);
                    container.appendChild(taskCard);
                }
            });
        }

        // Create task card
        function createTaskCard(task) {
            const card = document.createElement('div');
            card.className = 'task-card bg-white rounded-xl shadow-lg p-6 cursor-pointer';
            
            card.innerHTML = `
                <div class="text-center">
                    <div class="text-4xl mb-3">${task.icon}</div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">${task.title}</h3>
                    <p class="text-gray-600 text-sm mb-4">${task.description}</p>
                    <div class="flex items-center justify-between">
                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                            ${task.category}
                        </span>
                        <span class="text-green-600 font-bold">
                            +${task.points} ${task.perItem ? 'per item' : 'points'}
                        </span>
                    </div>
                    <button onclick="openUploadModal(${task.id})" class="w-full mt-4 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition-colors">
                        Complete Task
                    </button>
                </div>
            `;
            
            return card;
        }

        // Open upload modal
        function openUploadModal(taskId) {
            currentTask = tasks.find(t => t.id === taskId);
            document.getElementById('modalTitle').textContent = `Complete: ${currentTask.title}`;
            document.getElementById('uploadModal').classList.remove('hidden');
            document.getElementById('uploadModal').classList.add('flex');
        }

        // Close modal
        function closeModal() {
            document.getElementById('uploadModal').classList.add('hidden');
            document.getElementById('uploadModal').classList.remove('flex');
            document.getElementById('imagePreview').classList.add('hidden');
            document.getElementById('fileInput').value = '';
            document.getElementById('submitBtn').disabled = true;
            currentTask = null;
        }

        // Setup event listeners
        function setupEventListeners() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');

            uploadArea.addEventListener('click', () => fileInput.click());
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files[0]);
                }
            });

            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFileSelect(e.target.files[0]);
                }
            });
        }

        // Handle file selection
        function handleFileSelect(file) {
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imagePreview').classList.remove('hidden');
                    document.getElementById('submitBtn').disabled = false;
                };
                reader.readAsDataURL(file);
            }
        }

        // Submit task
        function submitTask() {
            if (!currentTask) return;

            let pointsToAdd = currentTask.points;
            
            // For plastic bottles, analyze the image and count bottles
            if (currentTask.perItem && currentTask.id === 2) {
                const bottleCount = analyzeBottlesInImage();
                if (bottleCount > 0) {
                    pointsToAdd = bottleCount * currentTask.points;
                    showBottleCountMessage(bottleCount);
                } else {
                    alert('No bottles detected in the image. Please upload a clear photo showing the bottles you collected.');
                    return;
                }
            }

            // Add to completed tasks
            completedTasks.push({
                ...currentTask,
                completedAt: new Date(),
                pointsEarned: pointsToAdd
            });

            // Update points with animation
            totalPoints += pointsToAdd;
            updatePointsDisplay();
            updateProgress();
            renderTasks();
            renderCompletedTasks();
            
            closeModal();
            
            // Show success message
            showSuccessMessage(pointsToAdd);
        }

        // Update points display
        function updatePointsDisplay() {
            const pointsElement = document.getElementById('totalPoints');
            pointsElement.textContent = totalPoints;
            pointsElement.classList.add('points-animation');
            setTimeout(() => {
                pointsElement.classList.remove('points-animation');
            }, 2000);
        }

        // Update progress
        function updateProgress() {
            const levels = [
                { min: 0, max: 50, badge: '🌱', name: 'Seedling' },
                { min: 50, max: 150, badge: '🌿', name: 'Sprout' },
                { min: 150, max: 300, badge: '🌳', name: 'Tree' },
                { min: 300, max: 500, badge: '🌲', name: 'Forest Guardian' },
                { min: 500, max: 1000, badge: '🏆', name: 'Eco Champion' }
            ];

            const currentLevelData = levels.find(level => totalPoints >= level.min && totalPoints < level.max) || levels[levels.length - 1];
            const progress = ((totalPoints - currentLevelData.min) / (currentLevelData.max - currentLevelData.min)) * 100;

            document.getElementById('progressBar').style.width = `${Math.min(progress, 100)}%`;
            document.getElementById('levelBadge').textContent = currentLevelData.badge;
            document.getElementById('levelText').textContent = `Level ${levels.indexOf(currentLevelData) + 1} - ${currentLevelData.name}`;
        }

        // Render completed tasks
        function renderCompletedTasks() {
            const container = document.getElementById('completedTasksContainer');
            
            if (completedTasks.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <div class="text-4xl mb-2">🎯</div>
                        <p>Complete tasks to see them here!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = '';
            completedTasks.forEach(task => {
                const card = document.createElement('div');
                card.className = 'bg-green-50 border border-green-200 rounded-xl p-6';
                
                card.innerHTML = `
                    <div class="text-center">
                        <div class="text-3xl mb-2">${task.icon}</div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">${task.title}</h3>
                        <div class="flex items-center justify-center space-x-2 mb-2">
                            <span class="text-green-600 font-bold">+${task.pointsEarned} points</span>
                            <span class="text-green-500">✓</span>
                        </div>
                        <p class="text-sm text-gray-600">
                            Completed ${new Date(task.completedAt).toLocaleDateString()}
                        </p>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // Analyze bottles in uploaded image
        function analyzeBottlesInImage() {
            // Simulate bottle detection based on image analysis
            // In a real implementation, this would use AI/ML for object detection
            const previewImg = document.getElementById('previewImg');
            
            if (!previewImg.src) return 0;
            
            // Simulate detection - random count between 1-10 bottles
            // This simulates what an AI would detect in the image
            const detectedBottles = Math.floor(Math.random() * 10) + 1;
            
            return detectedBottles;
        }

        // Show bottle count message
        function showBottleCountMessage(count) {
            const message = document.createElement('div');
            message.className = 'fixed top-4 right-4 bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 badge';
            message.innerHTML = `
                <div class="flex items-center space-x-2">
                    <span class="text-xl">🔍</span>
                    <span>Detected ${count} bottle${count > 1 ? 's' : ''} in your photo!</span>
                </div>
            `;
            
            document.body.appendChild(message);
            
            setTimeout(() => {
                message.remove();
            }, 2000);
        }

        // Show success message
        function showSuccessMessage(points) {
            const message = document.createElement('div');
            message.className = 'fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 badge';
            message.innerHTML = `
                <div class="flex items-center space-x-2">
                    <span class="text-xl">🎉</span>
                    <span>Task completed! +${points} points earned!</span>
                </div>
            `;
            
            document.body.appendChild(message);
            
            setTimeout(() => {
                message.remove();
            }, 3000);
        }

        // Initialize the app when page loads
        init();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'986c6e28d604ff7b',t:'MTc1OTE1ODg2Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
